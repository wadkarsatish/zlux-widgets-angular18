/*
  This program and the accompanying materials are
  made available under the terms of the Eclipse Public License v2.0 which accompanies
  this distribution, and is available at https://www.eclipse.org/legal/epl-v20.html
  
  SPDX-License-Identifier: EPL-2.0
  
  Copyright Contributors to the Zowe Project.
*/
import { NgModule, Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ZluxPopupPanelModule } from '../popup-panel/popup-panel.component';
import { ZluxErrorReportModule } from '../error-report/error-report.component';
import { ZluxPopupManagerService } from '../../services/popup-manager.service';
import * as i0 from "@angular/core";
import * as i1 from "../../services/popup-manager.service";
import * as i2 from "@angular/common";
import * as i3 from "../popup-panel/popup-panel.component";
import * as i4 from "../error-report/error-report.component";
export class ZluxPopupManagerComponent {
    static { this.REPORT_VISIBLE_TIMEOUT = 15; }
    constructor(popupManager) {
        this.popupManager = popupManager;
        this.blockCount = 0;
        this.currentErrorBlocking = null;
        this.currentErrorNonblocking = null;
        this.errors = [];
        popupManager.on('block', this.block.bind(this));
        popupManager.on('unblock', this.unblock.bind(this));
        popupManager.on('createReport', (error) => this.createReport(error));
        popupManager.on('removeReport', (id) => this.removeReport(id));
    }
    updateErrors() {
        if (this.currentErrorBlocking == null) {
            const found = this.errors.find(elem => elem.modal);
            if (found) {
                this.currentErrorBlocking = found;
                this.errors = this.errors.filter(i => i !== found);
            }
        }
        if (this.currentErrorNonblocking == null) {
            const found = this.errors.find(elem => !elem.modal);
            if (found) {
                this.currentErrorNonblocking = found;
                this.errors = this.errors.filter(i => i !== found);
            }
        }
    }
    createReport(error) {
        error = Object.assign({}, error);
        error.buttonCaptions = error.buttons.map(b => b.caption);
        this.errors.push(error);
        if (error.modal) {
            this.block();
        }
        this.updateErrors();
    }
    removeReport(id) {
        if (this.currentErrorBlocking && this.currentErrorBlocking.id === id) {
            this.closeForegroundError(this.currentErrorBlocking);
        }
        else if (this.currentErrorNonblocking && this.currentErrorNonblocking.id === id) {
            this.closeForegroundError(this.currentErrorNonblocking);
        }
        else {
            for (let i = 0; i < this.errors.length; i++) {
                if (this.errors[i].id === id) {
                    this.errors.splice(i, 1);
                }
            }
        }
    }
    block() {
        this.blockCount++;
    }
    unblock() {
        this.blockCount--;
    }
    closeForegroundError(error) {
        if (error === this.currentErrorBlocking) {
            this.unblock();
            this.currentErrorBlocking = null;
        }
        else {
            this.currentErrorNonblocking = null;
        }
        this.updateErrors();
    }
    onChoose(error, buttonCaption) {
        const button = error.buttons.find(b => b.caption === buttonCaption);
        if (button.closeReport) {
            this.closeForegroundError(error);
        }
        error.subject.next(buttonCaption);
    }
    getClass() {
        const _class = 'popup-shadow-hover';
        if (this.blockCount === 0) {
            return _class + ' hidden';
        }
        return null;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.3", ngImport: i0, type: ZluxPopupManagerComponent, deps: [{ token: i1.ZluxPopupManagerService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.1.3", type: ZluxPopupManagerComponent, selector: "zlux-popup-manager", ngImport: i0, template: "\n\n<!--\nThis program and the accompanying materials are\nmade available under the terms of the Eclipse Public License v2.0 which accompanies\nthis distribution, and is available at https://www.eclipse.org/legal/epl-v20.html\n\nSPDX-License-Identifier: EPL-2.0\n\nCopyright Contributors to the Zowe Project.\n-->\n\n@if (blockCount > 0) {\n  <div ngClass=\"popup-shadow-hover\">\n    @if (currentErrorBlocking) {\n      <zlux-popup-panel\n        [modal]=\"false\"\n        [autoShow]=\"true\"\n        [ignoreVeil]=\"true\"\n        ngClass=\"attachToCenter\"\n        >\n        <zlux-error-report\n          [severity]=\"currentErrorBlocking.severity\"\n          [title]=\"currentErrorBlocking.title\"\n          [timestamp]=\"currentErrorBlocking.timestamp\"\n          [buttons]=\"currentErrorBlocking.buttonCaptions\"\n          (action)=\"onChoose(currentErrorBlocking, $event)\"\n          [theme]=\"currentErrorBlocking.theme\"\n          [style]=\"currentErrorBlocking.style\"\n          [callToAction]=\"currentErrorBlocking.callToAction\"\n          >\n          {{currentErrorBlocking.text}}\n        </zlux-error-report>\n      </zlux-popup-panel>\n    }\n  </div>\n}\n@if (currentErrorNonblocking) {\n  <zlux-popup-panel\n    [modal]=\"false\"\n    [autoShow]=\"true\"\n    [blockDisplay]=\"true\"\n    ngClass=\"attachToCorner\"\n    >\n    <zlux-error-report\n      [severity]=\"currentErrorNonblocking.severity\"\n      [title]=\"currentErrorNonblocking.title\"\n      [timestamp]=\"currentErrorNonblocking.timestamp\"\n      [buttons]=\"currentErrorNonblocking.buttonCaptions\"\n      (action)=\"onChoose(currentErrorNonblocking, $event)\"\n      [theme]=\"currentErrorNonblocking.theme\"\n      [style]=\"currentErrorNonblocking.style\"\n      [callToAction]=\"currentErrorNonblocking.callToAction\"\n      >\n      {{currentErrorNonblocking.text}}\n    </zlux-error-report>\n  </zlux-popup-panel>\n}\n\n\n<!--\nThis program and the accompanying materials are\nmade available under the terms of the Eclipse Public License v2.0 which accompanies\nthis distribution, and is available at https://www.eclipse.org/legal/epl-v20.html\n\nSPDX-License-Identifier: EPL-2.0\n\nCopyright Contributors to the Zowe Project.\n-->\n\n", styles: [".popup-shadow-hover{background-color:#0006;position:absolute;inset:0;z-index:100}.hidden{display:none}.attachToCenter{min-width:400px;display:inline-block;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}.attachToCorner{min-width:400px;max-width:650px;position:absolute;right:20px;bottom:20px}\n"], dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "component", type: i3.ZluxPopupPanelComponent, selector: "zlux-popup-panel", inputs: ["modal", "autoShow", "ignoreVeil", "blockDisplay"] }, { kind: "component", type: i4.ZluxErrorReportComponent, selector: "zlux-error-report", inputs: ["severity", "title", "theme", "style", "buttons", "timestamp", "callToAction"], outputs: ["action"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.3", ngImport: i0, type: ZluxPopupManagerComponent, decorators: [{
            type: Component,
            args: [{ selector: "zlux-popup-manager", template: "\n\n<!--\nThis program and the accompanying materials are\nmade available under the terms of the Eclipse Public License v2.0 which accompanies\nthis distribution, and is available at https://www.eclipse.org/legal/epl-v20.html\n\nSPDX-License-Identifier: EPL-2.0\n\nCopyright Contributors to the Zowe Project.\n-->\n\n@if (blockCount > 0) {\n  <div ngClass=\"popup-shadow-hover\">\n    @if (currentErrorBlocking) {\n      <zlux-popup-panel\n        [modal]=\"false\"\n        [autoShow]=\"true\"\n        [ignoreVeil]=\"true\"\n        ngClass=\"attachToCenter\"\n        >\n        <zlux-error-report\n          [severity]=\"currentErrorBlocking.severity\"\n          [title]=\"currentErrorBlocking.title\"\n          [timestamp]=\"currentErrorBlocking.timestamp\"\n          [buttons]=\"currentErrorBlocking.buttonCaptions\"\n          (action)=\"onChoose(currentErrorBlocking, $event)\"\n          [theme]=\"currentErrorBlocking.theme\"\n          [style]=\"currentErrorBlocking.style\"\n          [callToAction]=\"currentErrorBlocking.callToAction\"\n          >\n          {{currentErrorBlocking.text}}\n        </zlux-error-report>\n      </zlux-popup-panel>\n    }\n  </div>\n}\n@if (currentErrorNonblocking) {\n  <zlux-popup-panel\n    [modal]=\"false\"\n    [autoShow]=\"true\"\n    [blockDisplay]=\"true\"\n    ngClass=\"attachToCorner\"\n    >\n    <zlux-error-report\n      [severity]=\"currentErrorNonblocking.severity\"\n      [title]=\"currentErrorNonblocking.title\"\n      [timestamp]=\"currentErrorNonblocking.timestamp\"\n      [buttons]=\"currentErrorNonblocking.buttonCaptions\"\n      (action)=\"onChoose(currentErrorNonblocking, $event)\"\n      [theme]=\"currentErrorNonblocking.theme\"\n      [style]=\"currentErrorNonblocking.style\"\n      [callToAction]=\"currentErrorNonblocking.callToAction\"\n      >\n      {{currentErrorNonblocking.text}}\n    </zlux-error-report>\n  </zlux-popup-panel>\n}\n\n\n<!--\nThis program and the accompanying materials are\nmade available under the terms of the Eclipse Public License v2.0 which accompanies\nthis distribution, and is available at https://www.eclipse.org/legal/epl-v20.html\n\nSPDX-License-Identifier: EPL-2.0\n\nCopyright Contributors to the Zowe Project.\n-->\n\n", styles: [".popup-shadow-hover{background-color:#0006;position:absolute;inset:0;z-index:100}.hidden{display:none}.attachToCenter{min-width:400px;display:inline-block;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}.attachToCorner{min-width:400px;max-width:650px;position:absolute;right:20px;bottom:20px}\n"] }]
        }], ctorParameters: () => [{ type: i1.ZluxPopupManagerService }] });
export class ZluxPopupManagerModule {
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.3", ngImport: i0, type: ZluxPopupManagerModule, deps: [], target: i0.ɵɵFactoryTarget.NgModule }); }
    static { this.ɵmod = i0.ɵɵngDeclareNgModule({ minVersion: "14.0.0", version: "18.1.3", ngImport: i0, type: ZluxPopupManagerModule, declarations: [ZluxPopupManagerComponent], imports: [CommonModule, ZluxPopupPanelModule, ZluxErrorReportModule], exports: [ZluxPopupManagerComponent] }); }
    static { this.ɵinj = i0.ɵɵngDeclareInjector({ minVersion: "12.0.0", version: "18.1.3", ngImport: i0, type: ZluxPopupManagerModule, providers: [ZluxPopupManagerService], imports: [CommonModule, ZluxPopupPanelModule, ZluxErrorReportModule] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.3", ngImport: i0, type: ZluxPopupManagerModule, decorators: [{
            type: NgModule,
            args: [{
                    imports: [CommonModule, ZluxPopupPanelModule, ZluxErrorReportModule],
                    exports: [ZluxPopupManagerComponent],
                    declarations: [ZluxPopupManagerComponent],
                    providers: [ZluxPopupManagerService]
                }]
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAtbWFuYWdlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy96bHV4LXdpZGdldHMvc3JjL2xpYi9jb21wb25lbnRzL3BvcHVwLW1hbmFnZXIvcG9wdXAtbWFuYWdlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy96bHV4LXdpZGdldHMvc3JjL2xpYi9jb21wb25lbnRzL3BvcHVwLW1hbmFnZXIvcG9wdXAtbWFuYWdlci5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQTs7Ozs7Ozs7RUFRRTtBQUVGLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3BELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUvQyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUM1RSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUMvRSxPQUFPLEVBQUUsdUJBQXVCLEVBQXFCLE1BQU0sc0NBQXNDLENBQUM7Ozs7OztBQU9sRyxNQUFNLE9BQU8seUJBQXlCO2FBQzdCLDJCQUFzQixHQUFXLEVBQUUsQUFBYixDQUFjO0lBTzNDLFlBQW9CLFlBQXFDO1FBQXJDLGlCQUFZLEdBQVosWUFBWSxDQUF5QjtRQUx6RCxlQUFVLEdBQVcsQ0FBQyxDQUFDO1FBQ3ZCLHlCQUFvQixHQUE0QixJQUFJLENBQUM7UUFDckQsNEJBQXVCLEdBQTRCLElBQUksQ0FBQztRQUN4RCxXQUFNLEdBQXdCLEVBQUUsQ0FBQztRQUcvQixZQUFZLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2hELFlBQVksQ0FBQyxFQUFFLENBQUMsU0FBUyxFQUFFLElBQUksQ0FB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Qix5QkFBeUIsMERDeEJ0Qyxtc0VBc0VBOzsyRkQ5Q2EseUJBQXlCO2tCQUxyQyxTQUFTOytCQUNFLG9CQUFvQjs7QUFxR2hDLE1BQU0sT0FBTyxzQkFBc0I7OEdBQXRCLHNCQUFzQjsrR0FBdEIsc0JBQXNCLGlCQWpHdEIseUJBQXlCLGFBNEYxQixZQUFZLEVBQUUsb0JBQW9CLEVBQUUscUJBQXFCLGFBNUZ4RCx5QkFBeUI7K0dBaUd6QixzQkFBc0IsYUFGdEIsQ0FBQyx1QkFBdUIsQ0FBQyxZQUgxQixZQUFZLEVBQUUsb0JBQW9CLEVBQUUscUJBQXFCOzsyRkFLeEQsc0JBQXNCO2tCQU5sQyxRQUFRO21CQUFDO29CQUNSLE9BQU8sRUFBRSxDQUFDLFlBQVksRUFBRSxvQkFBb0IsRUFBRSxxQkFBcUIsQ0FBQztvQkFDcEUsT0FBTyxFQUFFLENBQUMseUJBQXlCLENBQUM7b0JBQ3BDLFlBQVksRUFBRSxDQUFDLHlCQUF5QixDQUFDO29CQUN6QyxTQUFTLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQztpQkFDckMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuXHJcbi8qXHJcbiAgVGhpcyBwcm9ncmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscyBhcmVcclxuICBtYWRlIGF2YWlsYWJsZSB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEVjbGlwc2UgUHVibGljIExpY2Vuc2UgdjIuMCB3aGljaCBhY2NvbXBhbmllc1xyXG4gIHRoaXMgZGlzdHJpYnV0aW9uLCBhbmQgaXMgYXZhaWxhYmxlIGF0IGh0dHBzOi8vd3d3LmVjbGlwc2Uub3JnL2xlZ2FsL2VwbC12MjAuaHRtbFxyXG4gIFxyXG4gIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBFUEwtMi4wXHJcbiAgXHJcbiAgQ29weXJpZ2h0IENvbnRyaWJ1dG9ycyB0byB0aGUgWm93ZSBQcm9qZWN0LlxyXG4qL1xyXG5cclxuaW1wb3J0IHsgTmdNb2R1bGUsIENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb21tb25Nb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5cclxuaW1wb3J0IHsgWmx1eFBvcHVwUGFuZWxNb2R1bGUgfSBmcm9tICcuLi9wb3B1cC1wYW5lbC9wb3B1cC1wYW5lbC5jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBabHV4RXJyb3JSZXBvcnRNb2R1bGUgfSBmcm9tICcuLi9lcnJvci1yZXBvcnQvZXJyb3ItcmVwb3J0LmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFpsdXhQb3B1cE1hbmFnZXJTZXJ2aWNlLCBFcnJvclJlcG9ydFN0cnVjdCB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BvcHVwLW1hbmFnZXIuc2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogXCJ6bHV4LXBvcHVwLW1hbmFnZXJcIixcclxuICB0ZW1wbGF0ZVVybDogXCJwb3B1cC1tYW5hZ2VyLmNvbXBvbmVudC5odG1sXCIsXHJcbiAgc3R5bGVVcmxzOiBbXCJwb3B1cC1tYW5hZ2VyLmNvbXBvbmVudC5jc3NcIl0sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBabHV4UG9wdXBNYW5hZ2VyQ29tcG9uZW50IHtcclxuICBzdGF0aWMgUkVQT1JUX1ZJU0lCTEVfVElNRU9VVDogbnVtYmVyID0gMTU7XHJcblxyXG4gIGJsb2NrQ291bnQ6IG51bWJlciA9IDA7XHJcbiAgY3VycmVudEVycm9yQmxvY2tpbmc6IEVycm9yUmVwb3J0U3RydWN0IHwgYW55ID0gbnVsbDtcclxuICBjdXJyZW50RXJyb3JOb25ibG9ja2luZzogRXJyb3JSZXBvcnRTdHJ1Y3QgfCBhbnkgPSBudWxsO1xyXG4gIGVycm9yczogRXJyb3JSZXBvcnRTdHJ1Y3RbXSA9IFtdO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBvcHVwTWFuYWdlcjogWmx1eFBvcHVwTWFuYWdlclNlcnZpY2UpIHtcclxuICAgIHBvcHVwTWFuYWdlci5vbignYmxvY2snLCB0aGlzLmJsb2NrLmJpbmQodGhpcykpO1xyXG4gICAgcG9wdXBNYW5hZ2VyLm9uKCd1bmJsb2NrJywgdGhpcy51bmJsb2NrLmJpbmQodGhpcykpO1xyXG4gICAgcG9wdXBNYW5hZ2VyLm9uKCdjcmVhdGVSZXBvcnQnLCAoZXJyb3I6IEVycm9yUmVwb3J0U3RydWN0KSA9PiB0aGlzLmNyZWF0ZVJlcG9ydChlcnJvcikpO1xyXG4gICAgcG9wdXBNYW5hZ2VyLm9uKCdyZW1vdmVSZXBvcnQnLCAoaWQ6IG51bWJlcikgPT4gdGhpcy5yZW1vdmVSZXBvcnQoaWQpKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZUVycm9ycygpIHtcclxuICAgIGlmICh0aGlzLmN1cnJlbnRFcnJvckJsb2NraW5nID09IG51bGwpIHtcclxuICAgICAgY29uc3QgZm91bmQgPSB0aGlzLmVycm9ycy5maW5kKGVsZW0gPT4gZWxlbS5tb2RhbCk7XHJcbiAgICAgIGlmIChmb3VuZCkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudEVycm9yQmxvY2tpbmcgPSBmb3VuZDtcclxuICAgICAgICB0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzLmZpbHRlcihpID0+IGkgIT09IGZvdW5kKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuY3VycmVudEVycm9yTm9uYmxvY2tpbmcgPT0gbnVsbCkge1xyXG4gICAgICBjb25zdCBmb3VuZCA9IHRoaXMuZXJyb3JzLmZpbmQoZWxlbSA9PiAhZWxlbS5tb2RhbCk7XHJcbiAgICAgIGlmIChmb3VuZCkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudEVycm9yTm9uYmxvY2tpbmcgPSBmb3VuZDtcclxuICAgICAgICB0aGlzLmVycm9ycyA9IHRoaXMuZXJyb3JzLmZpbHRlcihpID0+IGkgIT09IGZvdW5kKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY3JlYXRlUmVwb3J0KGVycm9yKSB7XHJcbiAgICBlcnJvciA9IE9iamVjdC5hc3NpZ24oe30sIGVycm9yKTtcclxuICAgIGVycm9yLmJ1dHRvbkNhcHRpb25zID0gZXJyb3IuYnV0dG9ucy5tYXAoYiA9PiBiLmNhcHRpb24pO1xyXG4gICAgdGhpcy5lcnJvcnMucHVzaChlcnJvcik7XHJcbiAgICBpZiAoZXJyb3IubW9kYWwpIHtcclxuICAgICAgdGhpcy5ibG9jaygpO1xyXG4gICAgfVxyXG4gICAgdGhpcy51cGRhdGVFcnJvcnMoKTtcclxuICB9XHJcblxyXG4gIHJlbW92ZVJlcG9ydChpZDogbnVtYmVyKSB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50RXJyb3JCbG9ja2luZyAmJiB0aGlzLmN1cnJlbnRFcnJvckJsb2NraW5nLmlkID09PSBpZCkge1xyXG4gICAgICB0aGlzLmNsb3NlRm9yZWdyb3VuZEVycm9yKHRoaXMuY3VycmVudEVycm9yQmxvY2tpbmcpO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmN1cnJlbnRFcnJvck5vbmJsb2NraW5nICYmIHRoaXMuY3VycmVudEVycm9yTm9uYmxvY2tpbmcuaWQgPT09IGlkKSB7XHJcbiAgICAgIHRoaXMuY2xvc2VGb3JlZ3JvdW5kRXJyb3IodGhpcy5jdXJyZW50RXJyb3JOb25ibG9ja2luZyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZXJyb3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZXJyb3JzW2ldLmlkID09PSBpZCkge1xyXG4gICAgICAgICAgdGhpcy5lcnJvcnMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYmxvY2soKSB7XHJcbiAgICB0aGlzLmJsb2NrQ291bnQrKztcclxuICB9XHJcblxyXG4gIHVuYmxvY2soKSB7XHJcbiAgICB0aGlzLmJsb2NrQ291bnQtLTtcclxuICB9XHJcblxyXG4gIGNsb3NlRm9yZWdyb3VuZEVycm9yKGVycm9yKSB7XHJcbiAgICBpZiAoZXJyb3IgPT09IHRoaXMuY3VycmVudEVycm9yQmxvY2tpbmcpIHtcclxuICAgICAgdGhpcy51bmJsb2NrKCk7XHJcbiAgICAgIHRoaXMuY3VycmVudEVycm9yQmxvY2tpbmcgPSBudWxsO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5jdXJyZW50RXJyb3JOb25ibG9ja2luZyA9IG51bGw7XHJcbiAgICB9XHJcbiAgICB0aGlzLnVwZGF0ZUVycm9ycygpO1xyXG4gIH1cclxuXHJcbiAgb25DaG9vc2UoZXJyb3IsIGJ1dHRvbkNhcHRpb24pIHtcclxuICAgIGNvbnN0IGJ1dHRvbiA9IGVycm9yLmJ1dHRvbnMuZmluZChiID0+IGIuY2FwdGlvbiA9PT0gYnV0dG9uQ2FwdGlvbik7XHJcbiAgICBpZiAoYnV0dG9uLmNsb3NlUmVwb3J0KSB7XHJcbiAgICAgIHRoaXMuY2xvc2VGb3JlZ3JvdW5kRXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG4gICAgZXJyb3Iuc3ViamVjdC5uZXh0KGJ1dHRvbkNhcHRpb24pO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q2xhc3MoKSB7XHJcbiAgICBjb25zdCBfY2xhc3MgPSAncG9wdXAtc2hhZG93LWhvdmVyJztcclxuICAgIGlmICh0aGlzLmJsb2NrQ291bnQgPT09IDApIHtcclxuICAgICAgcmV0dXJuIF9jbGFzcyArICcgaGlkZGVuJztcclxuICAgIH1cclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuQE5nTW9kdWxlKHtcclxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlLCBabHV4UG9wdXBQYW5lbE1vZHVsZSwgWmx1eEVycm9yUmVwb3J0TW9kdWxlXSxcclxuICBleHBvcnRzOiBbWmx1eFBvcHVwTWFuYWdlckNvbXBvbmVudF0sXHJcbiAgZGVjbGFyYXRpb25zOiBbWmx1eFBvcHVwTWFuYWdlckNvbXBvbmVudF0sXHJcbiAgcHJvdmlkZXJzOiBbWmx1eFBvcHVwTWFuYWdlclNlcnZpY2VdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBabHV4UG9wdXBNYW5hZ2VyTW9kdWxlIHsgfVxyXG5cclxuXHJcbi8qXHJcbiAgVGhpcyBwcm9ncmFtIGFuZCB0aGUgYWNjb21wYW55aW5nIG1hdGVyaWFscyBhcmVcclxuICBtYWRlIGF2YWlsYWJsZSB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEVjbGlwc2UgUHVibGljIExpY2Vuc2UgdjIuMCB3aGljaCBhY2NvbXBhbmllc1xyXG4gIHRoaXMgZGlzdHJpYnV0aW9uLCBhbmQgaXMgYXZhaWxhYmxlIGF0IGh0dHBzOi8vd3d3LmVjbGlwc2Uub3JnL2xlZ2FsL2VwbC12MjAuaHRtbFxyXG4gIFxyXG4gIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBFUEwtMi4wXHJcbiAgXHJcbiAgQ29weXJpZ2h0IENvbnRyaWJ1dG9ycyB0byB0aGUgWm93ZSBQcm9qZWN0LlxyXG4qL1xyXG5cclxuIiwiXG5cbjwhLS1cblRoaXMgcHJvZ3JhbSBhbmQgdGhlIGFjY29tcGFueWluZyBtYXRlcmlhbHMgYXJlXG5tYWRlIGF2YWlsYWJsZSB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEVjbGlwc2UgUHVibGljIExpY2Vuc2UgdjIuMCB3aGljaCBhY2NvbXBhbmllc1xudGhpcyBkaXN0cmlidXRpb24sIGFuZCBpcyBhdmFpbGFibGUgYXQgaHR0cHM6Ly93d3cuZWNsaXBzZS5vcmcvbGVnYWwvZXBsLXYyMC5odG1sXG5cblNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBFUEwtMi4wXG5cbkNvcHlyaWdodCBDb250cmlidXRvcnMgdG8gdGhlIFpvd2UgUHJvamVjdC5cbi0tPlxuXG5AaWYgKGJsb2NrQ291bnQgPiAwKSB7XG4gIDxkaXYgbmdDbGFzcz1cInBvcHVwLXNoYWRvdy1ob3ZlclwiPlxuICAgIEBpZiAoY3VycmVudEVycm9yQmxvY2tpbmcpIHtcbiAgICAgIDx6bHV4LXBvcHVwLXBhbmVsXG4gICAgICAgIFttb2RhbF09XCJmYWxzZVwiXG4gICAgICAgIFthdXRvU2hvd109XCJ0cnVlXCJcbiAgICAgICAgW2lnbm9yZVZlaWxdPVwidHJ1ZVwiXG4gICAgICAgIG5nQ2xhc3M9XCJhdHRhY2hUb0NlbnRlclwiXG4gICAgICAgID5cbiAgICAgICAgPHpsdXgtZXJyb3ItcmVwb3J0XG4gICAgICAgICAgW3NldmVyaXR5XT1cImN1cnJlbnRFcnJvckJsb2NraW5nLnNldmVyaXR5XCJcbiAgICAgICAgICBbdGl0bGVdPVwiY3VycmVudEVycm9yQmxvY2tpbmcudGl0bGVcIlxuICAgICAgICAgIFt0aW1lc3RhbXBdPVwiY3VycmVudEVycm9yQmxvY2tpbmcudGltZXN0YW1wXCJcbiAgICAgICAgICBbYnV0dG9uc109XCJjdXJyZW50RXJyb3JCbG9ja2luZy5idXR0b25DYXB0aW9uc1wiXG4gICAgICAgICAgKGFjdGlvbik9XCJvbkNob29zZShjdXJyZW50RXJyb3JCbG9ja2luZywgJGV2ZW50KVwiXG4gICAgICAgICAgW3RoZW1lXT1cImN1cnJlbnRFcnJvckJsb2NraW5nLnRoZW1lXCJcbiAgICAgICAgICBbc3R5bGVdPVwiY3VycmVudEVycm9yQmxvY2tpbmcuc3R5bGVcIlxuICAgICAgICAgIFtjYWxsVG9BY3Rpb25dPVwiY3VycmVudEVycm9yQmxvY2tpbmcuY2FsbFRvQWN0aW9uXCJcbiAgICAgICAgICA+XG4gICAgICAgICAge3tjdXJyZW50RXJyb3JCbG9ja2luZy50ZXh0fX1cbiAgICAgICAgPC96bHV4LWVycm9yLXJlcG9ydD5cbiAgICAgIDwvemx1eC1wb3B1cC1wYW5lbD5cbiAgICB9XG4gIDwvZGl2PlxufVxuQGlmIChjdXJyZW50RXJyb3JOb25ibG9ja2luZykge1xuICA8emx1eC1wb3B1cC1wYW5lbFxuICAgIFttb2RhbF09XCJmYWxzZVwiXG4gICAgW2F1dG9TaG93XT1cInRydWVcIlxuICAgIFtibG9ja0Rpc3BsYXldPVwidHJ1ZVwiXG4gICAgbmdDbGFzcz1cImF0dGFjaFRvQ29ybmVyXCJcbiAgICA+XG4gICAgPHpsdXgtZXJyb3ItcmVwb3J0XG4gICAgICBbc2V2ZXJpdHldPVwiY3VycmVudEVycm9yTm9uYmxvY2tpbmcuc2V2ZXJpdHlcIlxuICAgICAgW3RpdGxlXT1cImN1cnJlbnRFcnJvck5vbmJsb2NraW5nLnRpdGxlXCJcbiAgICAgIFt0aW1lc3RhbXBdPVwiY3VycmVudEVycm9yTm9uYmxvY2tpbmcudGltZXN0YW1wXCJcbiAgICAgIFtidXR0b25zXT1cImN1cnJlbnRFcnJvck5vbmJsb2NraW5nLmJ1dHRvbkNhcHRpb25zXCJcbiAgICAgIChhY3Rpb24pPVwib25DaG9vc2UoY3VycmVudEVycm9yTm9uYmxvY2tpbmcsICRldmVudClcIlxuICAgICAgW3RoZW1lXT1cImN1cnJlbnRFcnJvck5vbmJsb2NraW5nLnRoZW1lXCJcbiAgICAgIFtzdHlsZV09XCJjdXJyZW50RXJyb3JOb25ibG9ja2luZy5zdHlsZVwiXG4gICAgICBbY2FsbFRvQWN0aW9uXT1cImN1cnJlbnRFcnJvck5vbmJsb2NraW5nLmNhbGxUb0FjdGlvblwiXG4gICAgICA+XG4gICAgICB7e2N1cnJlbnRFcnJvck5vbmJsb2NraW5nLnRleHR9fVxuICAgIDwvemx1eC1lcnJvci1yZXBvcnQ+XG4gIDwvemx1eC1wb3B1cC1wYW5lbD5cbn1cblxuXG48IS0tXG5UaGlzIHByb2dyYW0gYW5kIHRoZSBhY2NvbXBhbnlpbmcgbWF0ZXJpYWxzIGFyZVxubWFkZSBhdmFpbGFibGUgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYyLjAgd2hpY2ggYWNjb21wYW5pZXNcbnRoaXMgZGlzdHJpYnV0aW9uLCBhbmQgaXMgYXZhaWxhYmxlIGF0IGh0dHBzOi8vd3d3LmVjbGlwc2Uub3JnL2xlZ2FsL2VwbC12MjAuaHRtbFxuXG5TUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogRVBMLTIuMFxuXG5Db3B5cmlnaHQgQ29udHJpYnV0b3JzIHRvIHRoZSBab3dlIFByb2plY3QuXG4tLT5cblxuIl19